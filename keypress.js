(function(){var u,v,o,s,w,x,y,g,k,t,p,l,q,r,m,n,i,z,j=[].indexOf||function(a){for(var d=0,b=this.length;d<b;d++)if(d in this&&this[d]===a)return d;return-1};m=[];g=[];i=[];q=p=!1;t="ctrl";v={keys:[],count:0,is_ordered:!1,is_repeating:!1,on_down:null,on_release:function(){}};n=function(a,d){var b;if(!(a&&null!=d))return!1;if(-1<(b=a.indexOf(d)))[].splice.apply(a,[b,b-b+1].concat(b=[])),b;return a};u=function(){var a,d,b,c,e,f,g;d=[];c=0;for(f=arguments.length;c<f;c++){a=arguments[c];e=0;for(g=a.length;e<
g;e++)b=a[e],d.push(b)}return d};o=function(a,d){var b,c,e;if(a.length!==d.length)return!1;c=0;for(e=a.length;c<e;c++)if(b=a[c],!(0<=j.call(d,b)))return!1;c=0;for(e=d.length;c<e;c++)if(b=d[c],!(0<=j.call(a,b)))return!1;return!0};k=function(a,d,b){var c,e,f;null==a&&(a=g);null==d&&(d=m);null==b&&(b=!1);e=0;for(f=d.length;e<f;e++)if(c=d[e],c.is_ordered){if(a.join("")===c.keys.join("")||b&&a.join("")===c.keys.slice(0,a.length).join(""))return c}else if(o(a,c.keys)||b&&o(a,c.keys.slice(0,a.length)))return c;
return!1};l=function(a){q=!0;return a.preventDefault()};x=function(a,d){var b,c,e,f,h;f=!0;h=0;for(b=g.length;h<b;h++)e=g[h],e===a&&(f=!1);if(f){q=!1;g.push(a);if(e=k(g,i))e.is_activated=!1,l(d);else{f=null;c=h=1;for(b=g.length;1<=b?h<=b:h>=b;c=1<=b?++h:--h)c=g.slice(-c),f=k(c)||f;h=0;for(b=i.length;h<b;h++)c=i[h],c.is_activated||(c=u(c.keys,[a]),f=k(c)||f);if(f)e=$.extend(!0,{},f),i.push(e),l(d);else{f=0;for(h=m.length;f<h;f++)if(b=m[f],b=b.keys.slice(0,g.length),o(g,b)){l(d);return}}}if(e){if(e.is_repeating)e.count+=
1,e.on_down(e.count);else if("function"===typeof e.on_down)e.on_down();1<e.keys.length&&(f=n($.extend(!0,[],e.keys),a),f=k(f,i,!0),f!==e&&f&&n(i,f))}}else q&&l(d)};y=function(a){var d,b,c,e,f;if(!(0>j.call(g,a))){g=n(g,a);c=0;for(e=i.length;c<e;c++)if(d=i[c],0<=j.call(d.keys,a)){b=d;break}if(b){d=!1;f=b.keys;c=0;for(e=f.length;c<e;c++)if(a=f[c],0<=j.call(g,a)){d=!0;break}if(!b.is_activated)if(b.is_repeating){if(!d)b.on_release()}else b.on_release(),b.is_activated=!0;d||(i=n(i,b))}}};r=function(a,
d){var b;if(p)g.length&&(g=[]);else if(d||g.length)if(b=s(a.keyCode))return d?x(b,a):y(b)};z=function(a){var d,b,c,e;d=c=0;for(e=a.keys.length;0<=e?c<e:c>e;d=0<=e?++c:--c)b=a.keys[d],"meta"===b&&a.keys.splice(d,1,t);return!0};w=function(){-1!==navigator.userAgent.indexOf("Mac OS X")&&(t="cmd")};window.keypress={};keypress.wire=function(){w();$("body").bind("keydown.keypress_events",function(a){r(a,!0);if(0<=j.call(g,"cmd")&&"cmd"!==s(a.keyCode))return r(a,!1)}).bind("keyup.keypress_events",function(a){return r(a,
!1)});return $(window).bind("blur.keypress_events",function(){g=[];return i=[]})};keypress.combo=function(a,d){return keypress.register_combo({keys:a,on_release:d})};keypress.register_many_combos=function(a){var d,b,c;b=0;for(c=a.length;b<c;b++)d=a[b],keypress.register_combo(d);return!0};keypress.register_combo=function(a){$.extend(!0,{},v,a);if(z(a))return m.push(a),!0};keypress.listen=function(){return p=!1};keypress.stop_listening=function(){return p=!0};s=function(a){switch(a){case 9:return"tab";
case 13:return"enter";case 16:return"shift";case 17:return"ctrl";case 18:return"alt";case 27:return"escape";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";case 49:return"1";case 50:return"2";case 51:return"3";case 52:return"4";case 53:return"5";case 65:return"a";case 67:return"c";case 68:return"d";case 69:return"e";case 70:return"f";case 81:return"q";case 82:return"r";case 83:return"s";case 84:return"t";case 87:return"w";case 88:return"x";
case 90:return"z";case 91:return"cmd";case 224:return"cmd"}return!1}}).call(this);