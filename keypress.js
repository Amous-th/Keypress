(function(){var v,w,x,p,t,y,l,z,A,g,j,u,q,m,r,s,n,o,i,B,k=[].indexOf||function(a){for(var c=0,b=this.length;c<b;c++)if(c in this&&this[c]===a)return c;return-1};n=[];g=[];i=[];r=q=!1;u="ctrl";l=!1;x={keys:[],count:0,fire_on_keyup:!1,is_ordered:!1,is_repeating:!1,on_repeat:null,on_fire:function(){}};o=function(a,c){var b;if(!(a&&null!=c))return!1;if(-1<(b=a.indexOf(c)))[].splice.apply(a,[b,b-b+1].concat(b=[])),b;return a};w=function(){var a,c,b,d,e,f,g;c=[];d=0;for(f=arguments.length;d<f;d++){a=arguments[d];
e=0;for(g=a.length;e<g;e++)b=a[e],c.push(b)}return c};p=function(a,c){var b,d,e;if(a.length!==c.length)return!1;d=0;for(e=a.length;d<e;d++)if(b=a[d],!(0<=k.call(c,b)))return!1;d=0;for(e=c.length;d<e;d++)if(b=c[d],!(0<=k.call(a,b)))return!1;return!0};j=function(a,c,b){var d,e,f;null==a&&(a=g);null==c&&(c=n);null==b&&(b=!1);e=0;for(f=c.length;e<f;e++)if(d=c[e],d.is_ordered){if(a.join("")===d.keys.join("")||b&&a.join("")===d.keys.slice(0,a.length).join(""))return d}else if(p(a,d.keys)||b&&p(a,d.keys.slice(0,
a.length)))return d;return!1};m=function(a){r=!0;return a.preventDefault()};z=function(a,c){var b,d,e,f,h;f=!0;h=0;for(b=g.length;h<b;h++)e=g[h],e===a&&(f=!1);if(f){r=l=!1;g.push(a);if((e=j())&&!e.fire_on_keyup&&!e.is_repeating)e.on_fire(),l=e.is_activated=!0;if(e=j(g,i))e.is_activated=!1,m(c);else{f=null;d=h=1;for(b=g.length;1<=b?h<=b:h>=b;d=1<=b?++h:--h)d=g.slice(-d),f=j(d)||f;h=0;for(b=i.length;h<b;h++)d=i[h],d.is_activated||(d=w(d.keys,[a]),f=j(d)||f);if(f)e=$.extend(!0,{},f),i.push(e),m(c);else{f=
0;for(h=n.length;f<h;f++)b=n[f],b=b.keys.slice(0,g.length),p(g,b)&&m(c)}}console.log("Valid combos",i);if(e){if(e.is_repeating)e.count+=1,e.on_repeat(e.count);else if("function"===typeof e.on_repeat)e.on_repeat();1<e.keys.length&&(f=o($.extend(!0,[],e.keys),a),f=j(f,i,!0),f!==e&&f&&o(i,f))}}else r&&m(c)};A=function(a){var c,b,d,e,f;if(!(0>k.call(g,a))){g=o(g,a);d=0;for(e=i.length;d<e;d++)if(c=i[d],console.log("valid combo keys",c.keys),0<=k.call(c.keys,a)){b=c;break}if(b){c=!1;f=b.keys;d=0;for(e=
f.length;d<e;d++)if(a=f[d],0<=k.call(g,a)){c=!0;break}console.log("about to check:",b.is_activated,!b.fire_on_keyup,l);if(!b.is_activated&&b.fire_on_keyup&&!l)if(console.log("gonna fire"),b.is_repeating){if(!c)b.on_fire()}else b.on_fire(),b.is_activated=!0;c||(i=o(i,b))}}};s=function(a,c){var b;if(q)g.length&&(g=[]);else if(c||g.length)if(b=t(a.keyCode))return c?z(b,a):A(b)};B=function(a){var c,b,d,e;c=d=0;for(e=a.keys.length;0<=e?d<e:d>e;c=0<=e?++d:--d)b=a.keys[c],"meta"===b&&a.keys.splice(c,1,u);
return!0};y=function(){-1!==navigator.userAgent.indexOf("Mac OS X")&&(u="cmd")};v=function(a){var c;if(0<=k.call(g,"cmd")&&"cmd"!==(c=t(a.keyCode))&&"shift"!==c&&"alt"!==c)return s(a,!1)};window.keypress={};keypress.wire=function(){y();$("body").bind("keydown.keypress_events",function(a){s(a,!0);return v(a)}).bind("keyup.keypress_events",function(a){return s(a,!1)});return $(window).bind("blur.keypress_events",function(){g=[];return i=[]})};keypress.combo=function(a,c){return keypress.register_combo({keys:a,
on_fire:c})};keypress.register_many_combos=function(a){var c,b,d;b=0;for(d=a.length;b<d;b++)c=a[b],keypress.register_combo(c);return!0};keypress.register_combo=function(a){$.extend(!0,{},x,a);if(B(a))return n.push(a),!0};keypress.listen=function(){return q=!1};keypress.stop_listening=function(){return q=!0};t=function(a){switch(a){case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"ctrl";case 18:return"alt";case 27:return"escape";case 32:return"space";case 37:return"left";
case 38:return"up";case 39:return"right";case 40:return"down";case 49:return"1";case 50:return"2";case 51:return"3";case 52:return"4";case 53:return"5";case 65:return"a";case 67:return"c";case 68:return"d";case 69:return"e";case 70:return"f";case 81:return"q";case 82:return"r";case 83:return"s";case 84:return"t";case 87:return"w";case 88:return"x";case 90:return"z";case 91:return"cmd";case 224:return"cmd"}return!1}}).call(this);
