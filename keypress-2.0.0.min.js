/*
  Keypress version 2.0.0 (c) 2013 David Mauro.
  Licensed under the Apache License, Version 2.0
  http://www.apache.org/licenses/LICENSE-2.0
*/
(function(){var s,v,w,x,t,u,C,D,E,F,m,p,q,y,r,z,G,A={}.hasOwnProperty,h=[].indexOf||function(a){for(var c=0,b=this.length;c<b;c++)if(c in this&&this[c]===a)return c;return-1};t={is_ordered:!0,is_counting:!1,is_exclusive:!1,is_solitary:!1,prevent_default:!1,prevent_repeat:!1};z="meta alt option ctrl shift cmd".split(" ");y="ctrl";window.keypress={};keypress.debug=!1;var B=keypress,g=function(a){var c,b;for(c in a)A.call(a,c)&&(b=a[c],!1!==b&&(this[c]=b));this.keys=this.keys||[];this.count=this.count||
0};g.prototype.allows_key_repeat=function(){return!this.prevent_repeat&&"function"===typeof this.on_keydown};g.prototype.reset=function(){this.count=0;return this.keyup_fired=null};B.Combo=g;B=keypress;g=function(a,c){var b,d,e=this;this.should_force_event_defaults=this.should_suppress_event_defaults=!1;this.sequence_delay=800;this._registered_combos=[];this._keys_down=[];this._active_combos=[];this._sequence=[];this._sequence_timer=null;this._prevent_capture=!1;this._defaults=c||{};for(b in t)A.call(t,
b)&&(d=t[b],this._defaults[b]=this._defaults[b]||d);a=a||document.body;b=function(a,b,c){if(a.addEventListener)return a.addEventListener(b,c);if(a.attachEvent)return a.attachEvent("on"+b,c)};b(a,"keydown",function(a){a=a||window.event;e._receive_input(a,!0);return e._bug_catcher(a)});b(a,"keyup",function(a){a=a||window.event;return e._receive_input(a,!1)});b(window,"blur",function(){var a,b,c,d;d=e._keys_down;b=0;for(c=d.length;b<c;b++)a=d[b],e._key_up(a,{});return e._keys_down=[]})};g.prototype._bug_catcher=
function(a){var c;if(0<=h.call(this._keys_down,"cmd")&&"cmd"!==(c=w(a.keyCode))&&"shift"!==c&&"alt"!==c&&"caps"!==c&&"tab"!==c)return _receive_input(a,!1)};g.prototype._cmd_bug_check=function(a){return 0<=h.call(this._keys_down,"cmd")&&0>h.call(a,"cmd")?!1:!0};g.prototype._prevent_default=function(a,c){if((c||this.should_suppress_event_defaults)&&!this.should_force_event_defaults)if(a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation)return a.stopPropagation()};g.prototype._get_active_combos=
function(a){var c,b,d=this;c=[];b=u(this._keys_down,function(b){return b!==a});b.push(a);this._match_combo_arrays(b,function(a){if(d._cmd_bug_check(a.keys))return c.push(a)});this._fuzzy_match_combo_arrays(b,function(a){if(!(0<=h.call(c,a))&&!a.is_solitary&&d._cmd_bug_check(a.keys))return c.push(a)});return c};g.prototype._get_potential_combos=function(a){var c,b,d,e,f;b=[];f=this._registered_combos;d=0;for(e=f.length;d<e;d++)c=f[d],c.is_sequence||0<=h.call(c.keys,a)&&this._cmd_bug_check(c.keys)&&
b.push(c);return b};g.prototype._add_to_active_combos=function(a){var c,b,d,e,f,o,g,j,n,k,l;o=!1;f=!0;d=!1;if(0<=h.call(this._active_combos,a))return!0;if(this._active_combos.length){e=g=0;for(k=this._active_combos.length;0<=k?g<k:g>k;e=0<=k?++g:--g)if((c=this._active_combos[e])&&c.is_exclusive&&a.is_exclusive){c=c.keys;if(!o){j=0;for(n=c.length;j<n;j++)if(b=c[j],o=!0,0>h.call(a.keys,b)){o=!1;break}}if(f&&!o){l=a.keys;j=0;for(n=l.length;j<n;j++)if(b=l[j],f=!1,0>h.call(c,b)){f=!0;break}}o&&(d?(c=this._active_combos.splice(e,
1)[0],null!=c&&c.reset()):(c=this._active_combos.splice(e,1,a)[0],null!=c&&c.reset(),d=!0),f=!1)}}f&&this._active_combos.unshift(a);return o||f};g.prototype._remove_from_active_combos=function(a){var c,b,d,e;b=d=0;for(e=this._active_combos.length;0<=e?d<e:d>e;b=0<=e?++d:--d)if(c=this._active_combos[b],c===a){a=this._active_combos.splice(b,1)[0];a.reset();break}};g.prototype._get_possible_sequences=function(){var a,c,b,d,e,f,g,i,j,n,k,l;d=[];n=this._registered_combos;f=0;for(j=n.length;f<j;f++){a=
n[f];c=g=1;for(k=this._sequence.length;1<=k?g<=k:g>=k;c=1<=k?++g:--g)if(e=this._sequence.slice(-c),a.is_sequence){if(0>h.call(a.keys,"shift")&&(e=u(e,function(a){return"shift"!==a}),!e.length))continue;c=i=0;for(l=e.length;0<=l?i<l:i>l;c=0<=l?++i:--i)if(a.keys[c]===e[c])b=!0;else{b=!1;break}b&&d.push(a)}}return d};g.prototype._add_key_to_sequence=function(a,c){var b,d,e,f;this._sequence.push(a);d=this._get_possible_sequences();if(d.length){e=0;for(f=d.length;e<f;e++)b=d[e],this._prevent_default(c,
b.prevent_default);this._sequence_timer&&clearTimeout(this._sequence_timer);-1<this.sequence_delay&&(this._sequence_timer=setTimeout(function(){return this._sequence=[]},this.sequence_delay))}else this._sequence=[]};g.prototype._get_sequence=function(a){var c,b,d,e,f,g,i,j,n,k,l,m;k=this._registered_combos;g=0;for(n=k.length;g<n;g++)if(c=k[g],c.is_sequence){b=i=1;for(l=this._sequence.length;1<=l?i<=l:i>=l;b=1<=l?++i:--i)if(f=u(this._sequence,function(a){return 0<=h.call(c.keys,"shift")?!0:"shift"!==
a}).slice(-b),c.keys.length===f.length){b=j=0;for(m=f.length;0<=m?j<m:j>m;b=0<=m?++j:--j)if(e=f[b],!(0>h.call(c.keys,"shift")&&"shift"===e)&&!("shift"===a&&0>h.call(c.keys,"shift")))if(c.keys[b]===e)d=!0;else{d=!1;break}}if(d)return c}return!1};g.prototype._receive_input=function(a,c){var b;if(this._prevent_capture)this._keys_down.length&&(this._keys_down=[]);else if(c||this._keys_down.length)if(b=w(a.keyCode))return c?this._key_down(b,a):this._key_up(b,a)};g.prototype._fire=function(a,c,b){"function"===
typeof c["on_"+a]&&this._prevent_default(b,!0!==c["on_"+a].call(c["this"],b,c.count));"release"===a&&(c.count=0);if("keyup"===a)return c.keyup_fired=!0};g.prototype._match_combo_arrays=function(a,c){var b,d,e,f;f=this._registered_combos;d=0;for(e=f.length;d<e;d++)b=f[d],(b.is_ordered&&v(a,b.keys)||!b.is_ordered&&s(a,b.keys))&&c(b)};g.prototype._fuzzy_match_combo_arrays=function(a,c){var b,d,e,f;f=this._registered_combos;d=0;for(e=f.length;d<e;d++)b=f[d],(b.is_ordered&&D(b.keys,a)||!b.is_ordered&&
C(b.keys,a))&&c(b)};g.prototype._keys_remain=function(a){var c,b,d,e;e=a.keys;b=0;for(d=e.length;b<d;b++)if(a=e[b],0<=h.call(this._keys_down,a)){c=!0;break}return c};g.prototype._key_down=function(a,c){var b,d,e,f,g;(b=x(a,c))&&(a=b);this._add_key_to_sequence(a,c);(b=this._get_sequence(a))&&this._fire("keydown",b,c);for(e in r)b=r[e],c[b]&&(e===a||0<=h.call(this._keys_down,e)||this._keys_down.push(e));for(e in r)if(b=r[e],e!==a&&0<=h.call(this._keys_down,e)&&!c[b]){b=d=0;for(f=this._keys_down.length;0<=
f?d<f:d>f;b=0<=f?++d:--d)this._keys_down[b]===e&&this._keys_down.splice(b,1)}d=this._get_active_combos(a);e=this._get_potential_combos(a);f=0;for(g=d.length;f<g;f++)b=d[f],this._handle_combo_down(b,e,a,c);if(e.length){d=0;for(f=e.length;d<f;d++)b=e[d],this._prevent_default(c,b.prevent_default)}0>h.call(this._keys_down,a)&&this._keys_down.push(a)};g.prototype._handle_combo_down=function(a,c,b,d){var e,f,g,i,j;if(0>h.call(a.keys,b))return!1;this._prevent_default(d,a&&a.prevent_default);if(0<=h.call(this._keys_down,
b)&&!a.allows_key_repeat())return!1;e=!1;if(a.is_exclusive){i=0;for(j=c.length;i<j;i++)if(f=c[i],f.is_exclusive&&f.keys.length>a.keys.length){e=!0;break}}e||(g=this._add_to_active_combos(a,b));a.keyup_fired=!1;a.is_counting&&"function"===typeof a.on_keydown&&(a.count+=1);if(g)return this._fire("keydown",a,d)};g.prototype._key_up=function(a,c){var b,d,e,f,g,i;b=a;(e=x(a,c))&&(a=e);e=p[b];c.shiftKey?e&&0<=h.call(this._keys_down,e)||(a=b):b&&0<=h.call(this._keys_down,b)||(a=e);(f=this._get_sequence(a))&&
this._fire("keyup",f,c);if(0>h.call(this._keys_down,a))return!1;f=g=0;for(i=this._keys_down.length;0<=i?g<i:g>i;f=0<=i?++g:--g)if((d=this._keys_down[f])===a||d===e||d===b){this._keys_down.splice(f,1);break}d=this._active_combos.length;e=[];i=this._active_combos;f=0;for(g=i.length;f<g;f++)b=i[f],0<=h.call(b.keys,a)&&e.push(b);f=0;for(g=e.length;f<g;f++)b=e[f],this._handle_combo_up(b,c,a);if(1<d){g=this._active_combos;d=0;for(f=g.length;d<f;d++)b=g[d],void 0===b||0<=h.call(e,b)||this._keys_remain(b)||
this._remove_from_active_combos(b)}};g.prototype._handle_combo_up=function(a,c,b){var d,e;this._prevent_default(c,a&&a.prevent_default);e=this._keys_remain(a);if(!a.keyup_fired&&(d=this._keys_down.slice(),d.push(b),!a.is_solitary||s(d,a.keys)))this._fire("keyup",a,c),a.is_counting&&("function"===typeof a.on_keyup&&"function"!==typeof a.on_keydown)&&(a.count+=1);e||(this._fire("release",a,c),this._remove_from_active_combos(a))};g.prototype.combo=function(a,c,b){null==b&&(b=!1);return this.register_combo({keys:a,
on_keydown:c,prevent_default:b})};g.prototype.counting_combo=function(a,c,b){null==b&&(b=!1);return this.register_combo({keys:a,is_counting:!0,is_ordered:!0,on_keydown:c,prevent_default:b})};g.prototype.sequence_combo=function(a,c,b){null==b&&(b=!1);return this.register_combo({keys:a,on_keydown:c,is_sequence:!0,prevent_default:b})};g.prototype.register_combo=function(a){var c,b,d;"string"===typeof a.keys&&(a.keys=a.keys.split(" "));d=this._defaults;for(c in d)A.call(d,c)&&(b=d[c],void 0===a[c]&&(a[c]=
b));a=new keypress.Combo(a);if(G(a))return this._registered_combos.push(a),!0};g.prototype.register_many=function(a){var c,b,d,e;e=[];b=0;for(d=a.length;b<d;b++)c=a[b],e.push(this.register_combo(c));return e};g.prototype.unregister_combo=function(a){var c,b,d,e,f,g=this;if(!a)return!1;b=function(a){var b,c,d,e;e=[];b=c=0;for(d=g._registered_combos.length;0<=d?c<d:c>d;b=0<=d?++c:--c)if(a===g._registered_combos[b]){g._registered_combos.splice(b,1);break}else e.push(void 0);return e};if(a.keys)return b(a);
f=this._registered_combos;d=0;for(e=f.length;d<e;d++)c=f[d];"string"===typeof a&&(a=a.split(" "));if(!c.is_ordered&&s(a,c.keys)||c.is_ordered&&v(a,c.keys))return b(c)};g.prototype.unregister_many=function(a){var c,b,d,e;e=[];b=0;for(d=a.length;b<d;b++)c=a[b],e.push(this.unregister_combo(c));return e};g.prototype.get_registered_combos=function(){return this._registered_combos};g.prototype.reset=function(){return this._registered_combos=[]};g.prototype.listen=function(){return this._prevent_capture=
!1};g.prototype.stop_listening=function(){return this._prevent_capture=!0};B.Listener=g;w=function(a){return m[a]};u=function(a,c){var b;if(a.filter)return a.filter(c);var d,e,f;f=[];d=0;for(e=a.length;d<e;d++)b=a[d],c(b)&&f.push(b);return f};s=function(a,c){var b,d,e;if(a.length!==c.length)return!1;d=0;for(e=a.length;d<e;d++)if(b=a[d],!(0<=h.call(c,b)))return!1;return!0};v=function(a,c){var b,d,e;if(a.length!==c.length)return!1;b=d=0;for(e=a.length;0<=e?d<e:d>e;b=0<=e?++d:--d)if(a[b]!==c[b])return!1;
return!0};C=function(a,c){var b,d,e;d=0;for(e=a.length;d<e;d++)if(b=a[d],0>h.call(c,b))return!1;return!0};D=function(a,c){var b,d,e,f;e=d=0;for(f=a.length;e<f;e++)if(b=a[e],b=c.indexOf(b),b>=d)d=b;else return!1;return!0};q=function(){if(keypress.debug)return console.log.apply(console,arguments)};E=function(a){var c,b,d;c=!1;for(d in m)if(b=m[d],a===b){c=!0;break}if(!c)for(d in p)if(b=p[d],a===b){c=!0;break}return c};G=function(a){var c,b,d,e,f;a.keys.length||q("You're trying to bind a combo with no keys.");
b=e=0;for(f=a.keys.length;0<=f?e<f:e>f;b=0<=f?++e:--e)d=a.keys[b],(c=F[d])&&(d=a.keys[b]=c),"meta"===d&&a.keys.splice(b,1,y),"cmd"===d&&q('Warning: use the "meta" key rather than "cmd" for Windows compatibility');f=a.keys;c=0;for(e=f.length;c<e;c++)if(d=f[c],!E(d))return q('Do not recognize the key "'+d+'"'),!1;if(0<=h.call(a.keys,"meta")||0<=h.call(a.keys,"cmd")){c=a.keys.slice();e=0;for(f=z.length;e<f;e++)d=z[e],-1<(b=c.indexOf(d))&&c.splice(b,1);1<c.length&&q("META and CMD key combos cannot have more than 1 non-modifier keys",
a,c)}return!0};x=function(a,c){var b;if(!c.shiftKey)return!1;b=p[a];return null!=b?b:!1};r={cmd:"metaKey",ctrl:"ctrlKey",shift:"shiftKey",alt:"altKey"};F={escape:"esc",control:"ctrl",command:"cmd","break":"pause",windows:"cmd",option:"alt",caps_lock:"caps",apostrophe:"'",semicolon:";",tilde:"~",accent:"`",scroll_lock:"scroll",num_lock:"num"};p={"/":"?",".":">",",":"<","'":'"',";":":","[":"{","]":"}","\\":"|","`":"~","=":"+","-":"_",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(","0":")"};m=
{"0":"\\",8:"backspace",9:"tab",12:"num",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"caps",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"print",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"cmd",
92:"cmd",93:"cmd",96:"num_0",97:"num_1",98:"num_2",99:"num_3",100:"num_4",101:"num_5",102:"num_6",103:"num_7",104:"num_8",105:"num_9",106:"num_multiply",107:"num_add",108:"num_enter",109:"num_subtract",110:"num_decimal",111:"num_divide",124:"print",144:"num",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"`",224:"cmd",225:"alt",57392:"ctrl",63289:"num"};-1!==navigator.userAgent.indexOf("Mac OS X")&&(y="cmd");-1!==navigator.userAgent.indexOf("Opera")&&
(m["17"]="cmd")}).call(this);
